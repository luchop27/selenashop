{% extends 'base.html' %}
{% load static %}

{% block title %}Agregar Producto - Selena Store{% endblock %}

{% block menu_product %}active{% endblock %}

{% block content %}
<!-- main-content -->
<div class="main-content">
    <!-- main-content-inner -->
    <div class="main-content-inner">
        <!-- main-content-wrap -->
        <div class="main-content-wrap">
            <div class="flex items-center flex-wrap justify-between gap20 mb-30">
                <h3>Agregar producto</h3>
                <ul class="breadcrumbs flex items-center flex-wrap justify-start gap10">
                    <li>
                        <a href="{% url 'catalogo:panel_dashboard' %}">
                            <div class="text-tiny">Panel</div>
                        </a>
                    </li>
                    <li>
                        <i class="icon-chevron-right"></i>
                    </li>
                    <li>
                        <a href="{% url 'catalogo:panel_productos' %}">
                            <div class="text-tiny">Productos</div>
                        </a>
                    </li>
                    <li>
                        <i class="icon-chevron-right"></i>
                    </li>
                    <li>
                        <div class="text-tiny">Agregar producto</div>
                    </li>
                </ul>
            </div>
            <!-- form-add-product -->
            <form class="form-add-product" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="alert alert-danger">{{ form.non_field_errors }}</div>
                {% endif %}

                <!-- Upload images -->
                <div class="wg-box mb-30">
                    <fieldset>
                        <div class="body-title mb-10">Subir imágenes <span class="tf-color-1">*</span></div>
                        <div class="upload-image mb-16">
                            <div class="up-load">
                                    <label class="uploadfile" for="myFile">
                                        <span class="icon">
                                            <i class="icon-upload-cloud"></i>
                                        </span>
                                        <div class="text-tiny">Arrastra tus imágenes aquí o selecciona <span class="text-secondary">clic para examinar</span></div>
                                        {# Renderizamos el primer input del formset dentro del área de upload para mantener el diseño #}
                                        {% if imagen_formset.forms|length > 0 %}
                                            {{ imagen_formset.forms.0.url }}
                                        {% else %}
                                            <input type="text" id="myFile" class="tf-input" placeholder="Seleccionar archivo desde el administrador de archivos">
                                        {% endif %}
                                    </label>
                                </div>
                        </div>
                        <div class="body-text">Necesitas añadir al menos 4 imágenes. Presta atención a la calidad de las fotos, cumple los estándares de color de fondo y dimensiones. Las imágenes deben mostrar todos los detalles del producto.</div>
                        
                        <!-- Formset de imágenes -->
                        {{ imagen_formset.management_form }}
                        {% for f in imagen_formset.forms %}
                            <div class="mb-10">
                                {{ f.id }}
                                {% if f.url %}
                                    <fieldset class="name mb-8">
                                        <div class="body-text mb-4">{{ f.url.label }}</div>
                                        {{ f.url }}
                                        {% if f.url.errors %}
                                            <div class="text-danger">{{ f.url.errors }}</div>
                                        {% endif %}
                                    </fieldset>
                                {% endif %}
                                {% if f.variante %}
                                    <fieldset class="name mb-8">
                                        <div class="body-text mb-4">{{ f.variante.label }}</div>
                                        {{ f.variante }}
                                    </fieldset>
                                {% endif %}
                                {% if f.DELETE %}
                                    <div class="mb-8">
                                        {{ f.DELETE }} <label>Eliminar</label>
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </fieldset>
                </div>

                    <!-- Product Information -->
                    <div class="wg-box mb-30">
                        <!-- First row: title, category, style -->
                        <div class="cols-lg gap22">
                            <fieldset class="name">
                                <div class="body-title mb-10">Título del producto <span class="tf-color-1">*</span></div>
                                {{ form.nombre }}
                                {% if form.nombre.errors %}
                                    <div class="text-danger">{{ form.nombre.errors }}</div>
                                {% endif %}
                            </fieldset>

                            <fieldset class="category">
                                <div class="body-title mb-10">Categoría <span class="tf-color-1">*</span></div>
                                {{ form.categoria }}
                                {% if form.categoria.errors %}
                                    <div class="text-danger">{{ form.categoria.errors }}</div>
                                {% endif %}
                            </fieldset>

                            <fieldset class="category">
                                <div class="body-title mb-10">Estilo</div>
                                {{ form.estilo }}
                                {% if form.estilo.errors %}
                                    <div class="text-danger">{{ form.estilo.errors }}</div>
                                {% endif %}
                            </fieldset>
                        </div>

                        <!-- Second row: price, marca, material -->
                        <div class="cols-lg gap22">
                            <fieldset class="price">
                                <div class="body-title mb-10">Precio <span class="tf-color-1">*</span></div>
                                {{ form.precio_base }}
                                {% if form.precio_base.errors %}
                                    <div class="text-danger">{{ form.precio_base.errors }}</div>
                                {% endif %}
                            </fieldset>

                            <fieldset class="choose-brand">
                                <div class="body-title mb-10">Marca</div>
                                {{ form.marca }}
                                {% if form.marca.errors %}
                                    <div class="text-danger">{{ form.marca.errors }}</div>
                                {% endif %}
                            </fieldset>

                            <fieldset class="category">
                                <div class="body-title mb-10">Material</div>
                                {{ form.material }}
                                {% if form.material.errors %}
                                    <div class="text-danger">{{ form.material.errors }}</div>
                                {% endif %}
                            </fieldset>
                        </div>

                        <!-- Short description -->
                        <fieldset class="description">
                            <div class="body-title mb-10">Descripción corta</div>
                            {{ form.descripcion_corta }}
                            {% if form.descripcion_corta.errors %}
                                <div class="text-danger">{{ form.descripcion_corta.errors }}</div>
                            {% endif %}
                            <div class="text-tiny text-surface-2">No exceder 100 caracteres al ingresar la descripción corta del producto.</div>
                        </fieldset>

                        <!-- Flags / Toggles -->
                        <div class="cols-lg gap22">
                            <fieldset class="name">
                                <div class="body-title mb-10">Estado</div>
                                <div class="flex gap10 items-center">
                                    {{ form.activo }}
                                    <label for="{{ form.activo.id_for_label }}">Producto activo</label>
                                </div>
                            </fieldset>

                            <fieldset class="name">
                                <div class="body-title mb-10">Tiene tallas</div>
                                <div class="flex gap10 items-center">
                                    {{ form.tiene_tallas }}
                                    <label for="{{ form.tiene_tallas.id_for_label }}">Habilitar tallas</label>
                                </div>
                            </fieldset>

                            <fieldset class="category">
                                <div class="body-title mb-10">Slug</div>
                                {{ form.slug }}
                                {% if form.slug.errors %}
                                    <div class="text-danger">{{ form.slug.errors }}</div>
                                {% endif %}
                            </fieldset>
                        </div>
                    </div>

                <!-- Variants Section -->
                <div class="wg-box mb-30">
                    <fieldset>
                        <div class="body-title mb-10">Variantes del producto</div>
                        <div class="text-tiny mb-16">Agregar variantes como talla, color, material, etc.</div>
                        
                        {{ variante_formset.management_form }}
                        {% for vf in variante_formset.forms %}
                            <div class="variant-item mb-20" style="border: 1px solid #e5e7eb; padding: 15px; border-radius: 8px;">
                                <div class="body-text mb-10 fw-7">Variante #{{ forloop.counter }}</div>
                                
                                {% for field in vf.visible_fields %}
                                    <fieldset class="name mb-10">
                                        <div class="body-text mb-4">{{ field.label }}</div>
                                        {{ field }}
                                        {% if field.errors %}
                                            <div class="text-danger">{{ field.errors }}</div>
                                        {% endif %}
                                    </fieldset>
                                {% endfor %}
                                
                                {% if vf.DELETE %}
                                    <div class="mt-10">
                                        {{ vf.DELETE }} <label class="text-danger">Eliminar esta variante</label>
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </fieldset>
                </div>

                <!-- Submit buttons -->
                <div class="cols gap10">
                    <button class="tf-button w380" type="submit">Add product</button>
                    <a href="{% url 'catalogo:panel_productos' %}" class="tf-button style-3 w380">Cancel</a>
                </div>
            </form>
            <!-- /form-add-product -->
        </div>
        <!-- /main-content-wrap -->
    </div>
    <!-- /main-content-wrap -->
    <!-- bottom-page -->
    <div class="bottom-page">
        <div class="body-text">Copyright © 2024 <a href="#">Selena Store</a>. Design by Themesflat All rights reserved</div>
    </div>
    <!-- /bottom-page -->
</div>
<!-- /main-content -->
{% endblock %}
